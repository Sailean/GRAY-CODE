<!doctype html><meta charset="utf-8">
<title>GRAY CORD — Chrono Timeline</title>
<style>
body{font:14px/1.6 system-ui;margin:20px}
h2{margin-top:28px;border-left:4px solid #999;padding-left:8px}
.badge{font-size:12px;padding:2px 6px;border-radius:6px;margin-left:6px}
.published{background:#e6ffe6;border:1px solid #8bc48b}
.draft{background:#fff5e6;border:1px solid #e2a55e}
.planned{background:#eef;border:1px solid #99a"}
.note{background:#eee;border:1px solid #bbb}
ul{margin:6px 0 16px 20px}
li{margin:4px 0}
small{color:#666}
</style>
<h1>Chronological Timeline (for Author)</h1>
<div id="root"></div>
<script type="module">
const toc = await (await fetch('./data/toc.json')).json();
const tocMap = new Map(toc.map(x=>[String(x.id), x]));
const timeline = await (await fetch('./data/timeline.json')).json();

const root = document.getElementById('root');
for (const y of timeline.sort((a,b)=>a.year-b.year)) {
  const h = document.createElement('h2'); h.id = 'y'+y.year; h.textContent = y.year; root.append(h);
  const ul = document.createElement('ul');
  for (const ev of (y.items||[]).sort((a,b)=>(a.date||'').localeCompare(b.date||''))) {
    const li = document.createElement('li');
    const title = document.createElement('span');
    const badge = document.createElement('span');
    badge.className = `badge ${ev.status||'note'}`; badge.textContent = (ev.status||'note');
    // refs → 一番最初のpublishedをリンクに
    let linked = false;
    if (ev.refs && ev.refs.length) {
      for (const id of ev.refs) {
        const t = tocMap.get(String(id));
        if (t && t.status==='published' && t.url) {
          const a = document.createElement('a');
          a.href = t.url; a.target = '_blank';
          a.textContent = (ev.title_jp || ev.title_en || '(untitled)');
          title.append(a); linked = true; break;
        }
      }
    }
    if (!linked) title.textContent = (ev.title_jp || ev.title_en || '(untitled)');
    li.append(title, badge);
    if (ev.location || ev.actors) {
      const meta = document.createElement('small');
      meta.textContent = ` — ${ev.location||''} ${ev.actors?(' / '+ev.actors.join(', ')) : ''}`;
      li.append(' ', meta);
    }
    ul.append(li);
  }
  root.append(ul);
}
</script>
