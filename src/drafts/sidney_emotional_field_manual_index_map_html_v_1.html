<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sidney Grayson — Emotional Field Manual : INDEX MAP v1.8 (WebAudio Self‑Contained)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
    * { box-sizing: border-box; }
    body { background:#050706; color:#b0ffb3; font-family:"Share Tech Mono", monospace; text-shadow:0 0 6px #0f3; overflow:hidden; position:relative; }
    body::after { content:""; position:fixed; inset:0; background:repeating-linear-gradient(0deg, rgba(0,255,0,0.03) 0px, rgba(0,255,0,0.02) 1px, transparent 2px); mix-blend-mode:overlay; opacity:0.2; pointer-events:none; animation:scan 6s linear infinite; }
    @keyframes scan { from{background-position-y:0;} to{background-position-y:100%;} }
    .screen { width:90%; height:90vh; margin:5vh auto; border:2px solid #0f3; padding:1rem 1.5rem; background:radial-gradient(circle at center, rgba(0,64,32,0.25) 0%, rgba(0,0,0,0.9) 80%); box-shadow:0 0 20px #0f3; overflow-y:auto; }
    .cursor { display:inline-block; width:10px; height:1em; background:#0f3; animation:blink 1s steps(1) infinite; vertical-align:bottom; margin-left:4px; }
    @keyframes blink { 50% { opacity:0; } }
    .terminal-line { margin:.25rem 0; }
    .phase-naomi { color:#99ffe0; text-shadow:0 0 6px #00ffaa; }
    .phase-irina { color:#ff7b7b; text-shadow:0 0 6px #ff4444; }
    .phase-reina { color:#a3c4ff; text-shadow:0 0 6px #5fa6ff; }
    .phase-marla { color:#d9a3ff; text-shadow:0 0 6px #c060ff; }
    .phase-alisa { color:#ffe3a3; text-shadow:0 0 6px #ffd45f; }
    .phase-final { color:#b0ffb3; text-shadow:0 0 6px #0f3; }
    .overlay { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.75); backdrop-filter: blur(2px); z-index:999; }
    .overlay-inner { text-align:center; border:2px solid #0f3; padding:1.25rem 1.5rem; box-shadow:0 0 18px #0f3; background:rgba(0,32,16,0.6); }
    .btn { display:inline-block; padding:.5rem .9rem; border:2px solid #15a34a; color:#b9ffbf; background:#0b1f14; text-decoration:none; cursor:pointer; box-shadow:0 0 10px #0f3; }
    .btn:hover { background:#113421; color:#e4ffe6; }
    .controls { position:fixed; right:16px; bottom:16px; z-index:50; display:flex; gap:.5rem; align-items:center; background:#0b1f14; border:1px solid #155a31; padding:.4rem .6rem; box-shadow:0 0 8px #0f3; }
    .controls label { font-size:.8rem; color:#a6f7ad; }
    .controls input[type="range"] { accent-color:#36e07a; }
  </style>
</head>
<body>
  <!-- クリックで音を解禁（WebAudio生成のため外部ファイル不要） -->
  <div class="overlay" id="startOverlay">
    <div class="overlay-inner">
      <div class="phase-final" style="margin-bottom:.5rem">[ ACCESS REQUIRED ]</div>
      <div class="phase-final" style="margin-bottom:1rem">Click / Tap to initialize audio + begin transmission.</div>
      <button class="btn" id="startBtn">▶ START SESSION</button>
      <div style="margin-top:.75rem; font-size:.85rem; color:#98f7a3">※ WebAudio で音を合成するので、CORSや自動再生制限の影響を受けません。</div>
    </div>
  </div>

  <div class="screen" id="terminal" role="log" aria-live="polite"></div>

  <div class="controls" id="controls" style="display:none">
    <button class="btn" id="muteBtn" title="Mute / Unmute">🔊</button>
    <label>VOL <input id="vol" type="range" min="0" max="1" step="0.01" value="0.35"></label>
  </div>

  <script>
    // ===== WebAudio minimal synth (no external files) =====
    let ctx, masterGain, humOsc, humGain, clickGain;
    let muted = false;
    function initAudio(){
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = ctx.createGain(); masterGain.gain.value = 0.35; masterGain.connect(ctx.destination);
      // Low hum: two detuned sines + gentle lowpass noise
      humGain = ctx.createGain(); humGain.gain.value = 0.15; humGain.connect(masterGain);
      const o1 = ctx.createOscillator(); o1.type='sine'; o1.frequency.value = 58; o1.detune.value = -6; o1.connect(humGain); o1.start();
      const o2 = ctx.createOscillator(); o2.type='sine'; o2.frequency.value = 62; o2.detune.value = +6; o2.connect(humGain); o2.start();
      // subtle noise via buffer
      const buffer = ctx.createBuffer(1, ctx.sampleRate*2, ctx.sampleRate);
      const data = buffer.getChannelData(0);
      for(let i=0;i<data.length;i++){ data[i] = (Math.random()*2-1)*0.05; }
      const noise = ctx.createBufferSource(); noise.buffer = buffer; noise.loop = true; const lp = ctx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value=240; noise.connect(lp).connect(humGain); noise.start();
      // Click/Tick envelope bus
      clickGain = ctx.createGain(); clickGain.gain.value = 0; clickGain.connect(masterGain);
    }
    function setVolume(v){ if(masterGain){ masterGain.gain.value = v; } }
    function setMuted(v){ muted = v; if(masterGain){ masterGain.gain.value = v?0:document.getElementById('vol').value; } }
    function typeTick(){ if(!ctx||muted) return; const osc = ctx.createOscillator(); const g = ctx.createGain(); osc.type='square'; osc.frequency.value=2500; g.gain.value=0.0; osc.connect(g).connect(clickGain); const t = ctx.currentTime; g.gain.setValueAtTime(0.0,t); g.gain.linearRampToValueAtTime(0.12,t+0.005); g.gain.exponentialRampToValueAtTime(0.0001,t+0.06); osc.start(t); osc.stop(t+0.07); }

    // ===== Terminal typing =====
    const lines = [
      {t:"[ACCESS GRANTED] :: Sidney Grayson — Emotional Field Manual v1.8", c:"phase-final"},
      {t:"[MODE] Typewriter + CRT Simulation — Emotional Index Online", c:"phase-final"},
      {t:"---------------------------------------------", c:"phase-final"},
      {t:"> Loading timeline dataset: 1990–2025", c:"phase-final"},
      {t:"> Importing subject profiles: Naomi / Irina / Reina / Marla / Alisa", c:"phase-final"},
      {t:"> Emotional gradient: ACTIVE", c:"phase-final"},
      {t:"> Phase synchronization: STABLE", c:"phase-final"},
      {t:"> Transmission mode: RESEND ENABLED", c:"phase-final"},
      {t:"---------------------------------------------", c:"phase-final"},
      {t:"1990 :: Naomi :: 初恋／理想の喪失 — “帰る場所がない”", c:"phase-naomi"},
      {t:"1999 :: Irina :: 任務中の恋と裏切り — “愛は暗号化不能”", c:"phase-irina"},
      {t:"2004 :: Reina :: PTSD回復期の静的共感 — “触れない優しさ”", c:"phase-reina"},
      {t:"2008 :: Marla :: 依存と取引の夜 — “救済＝堕落”", c:"phase-marla"},
      {t:"2017 :: Alisa :: 再会と共進化 — “愛は報告書ではなく再送信”", c:"phase-alisa"},
      {t:"2025 :: 統合完了 — “Resend Success. Emotional integrity restored.”", c:"phase-final"},
      {t:"---------------------------------------------", c:"phase-final"},
      {t:"[LOG END]", c:"phase-final"}
    ];

    const terminal = document.getElementById('terminal');
    let index = 0;
    function typeLine(obj, cb){ const line=obj.t; let i=0; const div=document.createElement('div'); div.className='terminal-line '+obj.c; terminal.appendChild(div); (function step(){ if(i<line.length){ div.textContent += line.charAt(i); if(i%3===0) typeTick(); i++; setTimeout(step, 35+Math.random()*35); } else { cb(); } })(); }
    function nextLine(){ if(index<lines.length){ typeLine(lines[index], ()=>{ index++; terminal.scrollTop = terminal.scrollHeight; setTimeout(nextLine, 300); }); } else { const cur=document.createElement('span'); cur.className='cursor'; terminal.appendChild(cur); } }

    // ===== UI wiring =====
    const startBtn = document.getElementById('startBtn');
    const overlay = document.getElementById('startOverlay');
    const controls = document.getElementById('controls');
    const vol = document.getElementById('vol');
    const muteBtn = document.getElementById('muteBtn');

    startBtn.addEventListener('click', async ()=>{
      if(!ctx) initAudio();
      if(ctx.state==='suspended') await ctx.resume();
      overlay.style.display='none'; controls.style.display='flex';
      setVolume(parseFloat(vol.value));
      nextLine();
    });
    vol.addEventListener('input', (e)=> setVolume(parseFloat(e.target.value)) );
    muteBtn.addEventListener('click', ()=>{ setMuted(!muted); muteBtn.textContent = muted ? '🔇' : '🔊'; });
  </script>
</body>
</html>
