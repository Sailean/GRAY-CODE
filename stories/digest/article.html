<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è¨˜äº‹ãƒšãƒ¼ã‚¸</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="css/sailean_uikit.css">
  <link rel="stylesheet" href="css/uikit.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.15.0/dist/css/uikit.min.css">
  <link href="fontawesome/css/fontawesome.css" rel="stylesheet" media="print" onload="this.media='all'">
</head>

<body>

  <!--  navigation  -->
  <nav class="uk-navbar-container">
    <div class="uk-container">
      <div uk-navbar>
        <div class="uk-navbar-left">
          <a class="uk-navbar-item uk-logo" href="index.html">Nonlinear Emotion Curves</a>
          <ul class="uk-navbar-nav uk-visible@m">
            <li>
              <a class="uk-navbar-item uk-logo" href="index.html">éç·šå½¢æ„Ÿæƒ…æ›²ç·š </a>
              <div class="uk-navbar-dropdown">
                <ul id="digest-nav"></ul>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

<div class="uk-section uk-section-default uk-section-small uk-padding">
  <div class="uk-container uk-container-expand">
    <!-- ä¸Šéƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="chapter-nav uk-margin">
      <a id="prev-link" href="#">â† å‰ã¸</a>
    </nav>
    <h3 id="article-chapter" class="heading"></h3>
    <h3 id="article-title" class="heading"></h3>
    <p id="article-date" class="heading">ğŸ“œ è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
    <div id="article-content" class="uk-card uk-card-default uk-card-body">  
    </div>
    <!-- ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼šæ¬¡ã¸ã ã‘ -->
    <nav class="chapter-nav uk-margin-large-top uk-text-center">
      <a id="next-link" href="#">æ¬¡ã¸ â†’</a>
    </nav>           
  </div>
</div>

<!-- ä¸Šã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
<div id="topbutton" onclick="scrollToTop()" class="arrow" title="ä¸Šã¸æˆ»ã‚‹">â†‘</div>

<!-- ãƒ¡ã‚¤ãƒ³è¨˜äº‹èª­ã¿è¾¼ã¿ -->
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const lang = urlParams.get('lang') || 'jp';
  const file = urlParams.get('file');

// ğŸ”¹ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒŠãƒ“ç”¨ï¼ˆä¸Šéƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
fetch('articles.json')
  .then(res => res.json())
  .then(data => {
    const navList = document.getElementById('digest-nav');

    // ğŸ’¡ å›ºå®šãƒªãƒ³ã‚¯ï¼šç›®æ¬¡ï¼ˆindex.htmlï¼‰ã¸ã®ãƒªãƒ³ã‚¯ã‚’æœ€åˆã«è¿½åŠ 
    navList.innerHTML = `
      <li><a href="index.html">ğŸ“˜ ç›®æ¬¡ï¼ˆIndexï¼‰ã«æˆ»ã‚‹</a></li>
    `;

    // ğŸ”„ ã‚ã¨ã¯JSONã‹ã‚‰å‹•çš„ã«è¿½åŠ 
    navList.innerHTML += data.map(entry => {
      const title = lang === 'en' ? entry.title_en : entry.title_jp;
      return `<li><a href="article.html?file=${entry.filename}&lang=${lang}">ç¬¬${entry.chapter}ç«  ${title}</a></li>`;
    }).join('');
  });

  if (!file) {
    document.getElementById('article-content').innerHTML = '<p>âš  è¨˜äº‹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
  } else {
    fetch('articles.json?nocache=' + new Date().getTime())
      .then(response => response.json())
      .then(fileMap => {
        const meta = fileMap.find(entry => entry.filename === file);
        const base = file.endsWith('.en.md') ? 'en_articles' : 'articles';

        fetch(`${base}/${file}`)
          .then(response => response.text())
          .then(text => {
            document.getElementById('article-content').innerHTML = marked.parse(text);
            document.getElementById('article-title').innerText = meta?.title_jp || '(ã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š)';
            document.getElementById('article-date').innerText = meta?.date || '(æ—¥ä»˜ä¸æ˜)';
          })
          .catch(error => {
            document.getElementById('article-content').innerHTML = '<p>âš  è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>';
            console.error('Markdown èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          });
      })
      .catch(error => {
        document.getElementById('article-content').innerHTML = '<p>âš  ãƒ¡ã‚¿æƒ…å ±ï¼ˆarticles.jsonï¼‰ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
        console.error('JSON èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      });
  }
</script>

<!-- å‰ã¸ï¼æ¬¡ã¸ãƒªãƒ³ã‚¯ -->
<script>
  fetch('articles.json')
    .then(res => res.json())
    .then(data => {
      const params = new URLSearchParams(window.location.search);
      const file = params.get('file');
      const index = data.findIndex(item => item.filename === file);

      if (index > -1) {
        const prev = data[index - 1];
        const next = data[index + 1];

        if (prev) {
          document.getElementById('prev-link').href = `article.html?file=${prev.filename}`;
          document.getElementById('prev-link').innerText = `â† ${prev.title_jp}`;
        } else {
          document.getElementById('prev-link').style.visibility = 'hidden';
        }

        if (next) {
          document.getElementById('next-link').href = `article.html?file=${next.filename}`;
          document.getElementById('next-link').innerText = `${next.title_jp} â†’`;
        } else {
          document.getElementById('next-link').style.visibility = 'hidden';
        }
      }
    });
</script>

<script>
  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
</script>

<script>
  window.addEventListener("scroll", function () {
    const topBtn = document.getElementById("topbutton");
    topBtn.style.display = window.scrollY > 200 ? "block" : "none";
  });
</script>

<!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šæ¼”å‡ºç³» -->
<script>
  function runAkiraLogEffects() {
    const anchor = document.getElementById('cursor-anchor');
    if (anchor) {
      const cursor = document.createElement('span');
      cursor.id = 'terminal-cursor';
      anchor.parentNode.insertBefore(cursor, anchor.nextSibling);
    }

    const userSpans = document.querySelectorAll('.timestamp span.user');
    userSpans.forEach(span => {
      const text = span.innerText;
      if (text.includes('AKIRA:')) span.classList.add('akira-text');
      else if (text.includes('MAKO:')) span.classList.add('mako-text');
    });

    const messages = document.querySelectorAll('.timestamp');
    messages.forEach((msg, index) => {
      msg.style.opacity = '0';
      setTimeout(() => {
        msg.style.transition = 'opacity 0.1s ease-in';
        msg.style.opacity = '1';
      }, index * 50);
    });
  }

  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«1å›ã ã‘å®Ÿè¡Œ
  document.addEventListener('DOMContentLoaded', runAkiraLogEffects);
</script>


<!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆé¡ -->
<script src="js/load_articles.js"></script>
<script src="js/scripts.js"></script>
<script src="js/uikit.js" async></script>
<script src="js/uikit-icons.min.js"></script>
<script src="https://kit.fontawesome.com/e499977db9.js" crossorigin="anonymous" async></script>

</body>
</html>