README：コードのラブレター

【概要】

このプロジェクトは、短編小説「Will You Marry Me?」に登場する、あるエモーショナルなラブレターのプログラムを再現しています。このプログラムは、2010年に新渡朗（物語の主要キャラクター）が書き残したもので、Python 2環境でのみ実行可能です。物語の中で、このコードは彼の恋人である緑川英美子へのメッセージとして書かれました。

朗の手紙は、彼が感情を「計算しよう」とした挑戦を表しており、同時に彼自身の不器用な愛情表現でもあります。特定の条件でこのプログラムを実行すると、エラーとともに隠されたプロポーズのメッセージが現れる仕掛けが含まれています。



【プログラムの背景】

2010年6月、朗は英美子との関係に悩みながら、彼女への想いをコードに込めました。その想いは、彼の研究テーマである「感情の数理モデル」とリンクしながらも、彼自身の言葉では伝えきれない愛情を表現しています。このプログラムは、その葛藤を象徴しています。

プログラムをPython 2環境で実行すると、エラーとして以下のメッセージが現れます：

"Will you marry me?" （結婚してくれますか？）

朗はこのプログラムを自らのG3の空っぽのベイに隠し、彼女に直接渡すことなくアメリカに旅立ちました。その後、このコードが発見されたのは2024年のクリスマス、英美子と娘の眞によってでした。



【このプログラムの特徴】

1. Python 2での実行を前提
　コードは2010年当時のPython 2で書かれており、最新のPython 3では動作しません。仮想環境を構築し、Python 2環境で動かす必要があります。

2. 隠されたメッセージ
　プログラム内には、ASCIIコードを用いて隠されたプロポーズのメッセージが組み込まれています。エラー発生時に表示される仕様となっています。

3. 物語の背景とのリンク
　このコードは単なるプログラムではなく、物語の中で重要な役割を果たします。朗の不器用な愛情表現と、英美子への深い想いが込められています。



【プログラムの内容】

# -*- coding: utf-8 -*-
import datetime
import sys

def relationship_equation(true_value, regret, special_date):
    """
    愛の関係性を「計算」しようとする関数。
    本質的には「愛の告白」をエラーとして隠す仕掛けがあります。
    2010に書かれたという設定のだめ、仮想環境を作ってPython2で実行すると、エラーでプロポーズのメッセージを返します。
    """

    try:
        # 特別な日付を解析してエンコード
        key_date = datetime.datetime.strptime(special_date, "%Y-%m-%d")
        day_code = key_date.day * key_date.month  # 日付を「キー」に変換

        # 愛と後悔を数値的にエンコード
        love_coefficient = (12 * 15) + (22 * 5)  # 'L'と'O'を数字にした例（LOVE）
        regret_factor = (19 * 15) + (18 * 25)   # 'S'と'R'を数字にした例（SORRY）

        # 愛の「関係式」：愛、後悔、特別な日（12/25）を基に計算
        # Python 2限定の整数除算 (// を使わず、切り捨て)
        result = true_value * (love_coefficient - regret) / (1 + day_code)

        # 計算結果が特定の条件を満たさない場合（ここでは0以下）、エラーを発生
        if result <= 0:
            raise ValueError("Critical computation failed")

        # 計算成功時の結果を返す
        return result, "I tried"

    except ValueError:
        # エラーが発生した場合、隠された告白メッセージを表示
        secret_message = u"".join([unichr(x) for x in [87, 105, 108, 108, 32, 121, 111, 117, 32, 
                                                        109, 97, 114, 114, 121, 32, 109, 101, 63]])
        # 上記のunichrのリストは、"Will you marry me?" をASCIIコードで隠したもの。
        # メッセージをシステムエラー出力として表示。
        sys.stderr.write(u"\nERROR: %s\n" % secret_message)
        return None, "I failed"  # 返り値として結果なし(None)とエラーメッセージを出力
        

# この関数を使って「特定の関係性」を計算しようと試みる
special_date = "2010-12-25"  # 英美子の誕生日（プロポーズする予定だった日付け）
true_value = 1               # 愛の「真実」の値（シンプルに1とした）
regret = 300                 # 計算を失敗させるための後悔値（意図的に大きく設定）

# 関数を実行して結果を取得
result, message = relationship_equation(true_value, regret, special_date)

# 計算の結果（もしくはエラー）を表示
print result, message

# A hidden signature for Emiko
print "For Emiko"

-----------

【実行手順】

1. 仮想環境の構築
Python 2.7をインストールし、仮想環境を作成してください。

2. コードの実行
上記のコードをPython 2環境で実行してください。

3. エラーとメッセージの確認
プログラムはエラーを出力し、隠されたプロポーズのメッセージが表示されます。

3. 現代的なアプローチ
最新のPython 3で調整されたバージョンも、Googleコラボからコードを実行できます（Python3に調整したものと、Python2の古いコードもあります）。
https://colab.research.google.com/drive/1L0d0u7HJdEVljOzLCusYhoS0unfJCFN9?usp=sharing
ただし、当時の「味わい」を体験するには、Python 2での実行が最適です。



【物語のメッセージ】

朗の不器用さと英美子への深い想い、そして二人の間にあるすれ違いが、このプログラムには反映されています。彼が残したこのコードは、14年の時を経て、英美子と眞によって再発見されます。
この瞬間、朗の想いは未来へと繋がり、彼の研究と人生に新たな意味が生まれます。

